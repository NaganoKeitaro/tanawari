# 基本設計書 (Basic Design Document)

**作成日**: 2026-01-09
**プロジェクト**: 棚割管理システム (Planogram System) MVP

## 1. 機能設計書 (Functional Design)

本システムの主要機能、画面フロー、およびユーザーインターフェース仕様を記述する。

### 1.1 画面遷移図 (Screen Transition)

全体の画面フローは以下の通りである。

![Screen Transition Diagram](./docs/images/screen_transition.png)

### 1.2 画面一覧と機能詳細

#### 1.2.1 ログイン / ホーム (Login / Home)
*   **概要**: システムへの入口。ダッシュボードとして、作業中の棚割ステータスや重要なお知らせを表示する。
*   **主な機能**:
    *   ログイン認証（MVPでは簡易ID/PW、または省略）
    *   メニューナビゲーション（マスタ管理、標準棚割、個店棚割、帳票）
    *   システム初期化・シードデータ投入ボタン（管理者用）

#### 1.2.2 マスタ管理 (Master Management)
以下のマスタデータを管理するCRUD画面群。

| 画面名 | 入出力項目例 | 機能・ボタン |
| :--- | :--- | :--- |
| **商品マスタ一覧/編集** | JAN、商品名、サイズ(W/H/D)、売上ランク、画像 | 検索、新規登録、編集、削除（論理削除）、CSVインポート |
| **店舗マスタ一覧/編集** | 店舗コード、名称、FMT、地域 | 検索、新規登録、編集、削除 |
| **什器マスタ一覧/編集** | 什器名、サイズ、デフォルト段数 | 新規登録、編集 |
| **店舗什器配置** | 店舗選択、什器選択、配置座標(X/Y) | ドラッグ＆ドロップ配置、幅計算、保存 |

#### 1.2.3 標準棚割管理 (Standard Planogram Management)
FMTごとの基準となる棚割を作成する機能。

*   **棚ブロック管理**:
    *   商品を組み合わせた「ブロック」を作成する。
    *   ブロック内の商品配置（フェイス数、順序）を定義。
*   **標準棚割エディタ**:
    *   基準店舗とFMTを選択して新規作成。
    *   画面左側：ブロック一覧（パレット）。
    *   画面右側：棚什器レイアウト（キャンバス）。
    *   **操作**: ブロックをドラッグ＆ドロップで棚に配置。

#### 1.2.4 個店棚割管理 (Store Planogram Management)
各店舗のサイズに合わせて展開された棚割を管理する。

*   **一括自動生成 (Bulk Generation)**:
    *   対象店舗（全店 or 地域指定）を選択し、実行ボタン押下。
    *   **ロジック概要**:
        *   店舗棚幅 < 標準棚幅: 売上ランク下位から商品をカット。
        *   店舗棚幅 > 標準棚幅: 売上ランク上位商品をフェイス拡張。
        *   ※詳細は[詳細設計書](./detailed_design.md)を参照。
    *   進捗バー表示と完了レポート（成功/失敗/警告件数）。
*   **個店棚割エディタ**:
    *   自動生成結果の確認と微調整。
    *   **機能**:
        *   **同期 (Sync)**: 最新の標準棚割の変更を取り込む。
        *   **手動調整**: 商品の追加・削除・フェイス変更・移動。
        *   **バリデーション**: 棚幅超過時の警告表示。

### 1.3 UI/UX設計 (Design System)

ユーザーインターフェースの統一基準。

*   **カラーパレット**:
    *   Primary: Indigo (#6366f1) - メインアクション
    *   Warning: Amber (#f59e0b) - ランク中位・注意喚起、狭小店舗
    *   Danger: Rose (#f43f5e) - ランク下位・削除・エラー、容量オーバー
    *   Success: Emerald (#10b981) - ランク上位・正常完了
*   **単位表示**:
    *   システム内部: `cm` で統一管理
    *   UI表示: `120cm (4.0尺)` のようにユーザー慣習に合わせて尺貫法を併記する場合がある。
*   **インタラクション**:
    *   **ドラッグ＆ドロップ**: 商品配置、ブロック配置に全面的に採用。
    *   **視覚フィードバック**: ドラッグ中のドロップ可能領域ハイライト、配置不可エリアのグレーアウト。

## 2. 帳票設計書 (Report Design)

システムから出力される帳票およびデータファイル。

### 2.1 棚割指示書 (Planogram Instruction Sheet)
店舗で棚替え作業を行うためのPDF/Excel帳票。

*   **出力対象**: 特定の個店棚割、または標準棚割。
*   **フォーマット**: PDF (A4横)
*   **内容**:
    *   **ヘッダー**: 店舗名、対象棚名称、適用開始日。
    *   **全体図**: 什器ごとのブロック配置概略。
    *   **詳細図**: 棚段ごとの商品配置（JAN、商品名、フェイス数）。
    *   **商品リスト**: 陳列商品一覧と必要総在庫数。

### 2.2 商品採用リスト (Product Placement List)
本部分析用のCSVデータ。

*   **出力**: CSVダウンロード
*   **項目**:
    *   店舗コード、店舗名
    *   商品コード、商品名、区分（定番/カット/拡張）
    *   フェイス数
    *   展開場所（什器、段数）

### 2.3 差分リスト (Diff Report)
前回棚割との変更点を抽出したリスト。

*   **用途**: 店舗での作業負担軽減（変更箇所のみ作業するため）。
*   **項目**:
    *   追加商品一覧（NEW）
    *   削除商品一覧（DELETE）
    *   フェイス変更商品一覧（CHANGE）

## 3. データベース論理設計書 (Database Logical Design)

データ構造については、以下の別ドキュメントにて定義する。

*   [**データベース論理設計書 (database_logical_design.md)**](./database_logical_design.md)
    *   ER図
    *   テーブル定義
    *   ビュー定義
